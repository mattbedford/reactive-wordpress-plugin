# Setting up React JS independently
### A how-to on setting up your WP to use React.

## Step 1. The easy stuff.
1. Install node and NPM.
You'll want the latest version or LTS is OK too.

2. Build your local WP.
I like wp-env, but whatever you like. Docker is good for this as is Local.

3. Create the plugin directory
Go to your ```wp-content``` folder and create a brand new empty dir. Add a new main plugin file, call it ```init.php``` and add in the classic WordPress plugin header boilerplate:
```php
/*
* Plugin Name: whatever
*/
```


## Step 2. The messy stuff.
1. Add a package JSON. 
- Don't be scared. In the root of your new directory, create a blank file and call it ```package.json```
- Paste the following code into it:
```json
{
  "name": "whatever",
  "version": "1.0.0",
  "description": "Add a description here",
  "main": "index.js",
  "scripts": {
    "build": "wp-scripts build",
    "start": "wp-scripts start"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "@wordpress/scripts": "^30.7.0",
    "path": "^0.12.7",
    "webpack-remove-empty-scripts": "^1.0.4"
  }
}
```
- then open your terminal/command-line app (check you are in the new directory you just created) and run ```npm install @wordpress/scripts path webpack-remove-empty-scripts --save-dev```
- That'll take a few minutes. If you get any errors during this step, it's likely because your NPM is too old. If so, delete the package-lock.json and the node_modules folder, update NPM and try again.

2. Add in a webpack file.
- In your new plugin directory, create a new file. This time name it ```webpack.config.js```
- Inside of it, paste the following:
```js
const defaults = require("@wordpress/scripts/config/webpack.config");
const RemoveEmptyScriptsPlugin = require( 'webpack-remove-empty-scripts' );

// Utilities.
const path = require( 'path' );
module.exports = {
    ...defaults,
    externals: {
        "react": "React",
        "react-dom": "ReactDOM"
    },
    ...{
        plugins: [
            // Include WP's plugin config.
            ...defaults.plugins,

            // Removes the empty `.js` files generated by webpack but
            // sets it after WP has generated its `*.asset.php` file.
            new RemoveEmptyScriptsPlugin( {
                stage: RemoveEmptyScriptsPlugin.STAGE_AFTER_PROCESS_PLUGINS
            } )
        ]
    }
};
```

## Step 3. Set up the React stuff
1. Still in the root directory of your new plugin, create a new folder called ```src```.
2. Inside it, create three files: ```App.js``` (note the capital A) and ```index.js``` (note the small i) and ```styles.scss```.
3. Inside ```index.js``` we need to include React, but we do it from @wp-scripts. Just paste in the following:
```js
import App from './App';
import './styles.scss';

const {createRoot} = wp.element;

const container = document.getElementById('react-app');
const root = createRoot(container);
root.render(<App />);
```
4. And inside ```App.js``` we'll put a tiny React script as a proof of concept. Paste in the following:
```js
const App = () => {

    return (
        <div id="react-base">
            Hello from React, baby!
        </div>

    );

};
export default App;
```
5. You dopn't need to add anything to the styles file yet. But it needs to be there. 

## Step 4. Set up the WP stuff
1. First, we need to give WordPress a way to print our React root element to the screen. The easiest way is (for now) to 
  add this in an action hook - maybe in the footer. To do so, add this script in your ```init.php``` file:
```php
function add_custom_React_div() {
    echo "<div>";
    echo "<div id='react-app'>";
    echo "</div>";
    echo "</div>";
}
add_action('wp_footer', 'add_custom_React_div');
```
2. And next we need to enqueue all our scripts to run the React. This is a normal script enqueue, but we make sure to 
  include a few dependencies. Don't forget these - they're critical. These go in your ```init.php``` file also.
```php
function load_custom_react_scripts()
{
    if(is_admin()) return;
    // Add your conditionals here to only run scripts where you want them.
    $plugin_url  = plugin_dir_url( __FILE__ );
    wp_enqueue_script('react-wp-app-script',
        $plugin_url . '/build/index.js',
        array('wp-element', 'wp-api-fetch', 'react-jsx-runtime'),
        '1.00',
        true);
    wp_enqueue_style('react-wp-app-style',
        $plugin_url . '/build/index.css');
}
add_action('wp_enqueue_scripts', 'load_custom_react_scripts');
```

## Step 5. Test it all out
1. Head over to the admin plugins page and activate your plugin.
2. (And remember this step - without this it won't work): go back to the ___root folder of your new plugin___, and once inside 
  you need to run the WP build scripts. In a command line just do ```npm start```.
3. When we finish our plugin, we'll want to do ```npm build``` instead, btw.
4. Then go to the front end and check it out. Success!
5. Well. Maybe. It may take a few reloads for WP to recognise the build AND you may need to check the devtools network tab to
  be sure that the files are loaded correctly.
> NOTE:
> The html you see on the front-end (and the js that powers it) is built from the "build" folder. Instead all the edits you make
> in your React app ___need___ to be made inside the SRC folder. 


## Next steps. Taking it further
1. Set up a component structure. 
You can keep all your JavaScript inside the App.js file if you like, but adopting a component structure is probably better.
- Create 3 folders inside your SRC directory: ```assets```, ```pages```, and ```components```.
- Assets is for images, icons, etc, but the other two folders acts as a hierarchy of React. Components are part of pages, 
  and pages are part of your App file. E.g.

```js
// ./src/components/counter.js

function Counter() {

  const useState = wp.element.useState;

  // Note how we pass in "0", which gives our initial state.
  const [count, setCount] = useState(0);

  function handleClick() {
    setCount(count + 1);
  }

  return (
          <button onClick={handleClick}>
            Clicked {count} times
          </button>
  );
}

export default Counter;

```

```js

// ./src/pages/homepage.js
import Counter from '../components/counter.js';

const Homepage = () => {

  return (
          <div id="react-base">
            <Counter></Counter>
          </div>

  );

};
export default Homepage;

```

```js
// ./src/App.js

import Homepage from './pages/homepage.js';

const App = () => {

  return (
          <>
            <Homepage></Homepage>
          </>

  );

};
export default App;

```